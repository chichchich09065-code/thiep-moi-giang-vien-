<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Thiệp tri ân giảng viên</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
  }
  #canvas-container {
    position: relative;
    display: inline-block;
  }
  canvas {
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  input, button {
    margin: 10px;
    padding: 8px 12px;
  }
</style>
</head>
<body>
  <h2>Tạo thiệp tri ân giảng viên</h2>
  <div id="canvas-container">
    <canvas id="canvas" width="900" height="600"></canvas>
  </div>
  <br>
  <input type="file" id="upload" accept="image/*">
  <button id="download">Tải ảnh về</button>

  <script>
    const frameUrl = "https://raw.githubusercontent.com/chichchich09065-code/thiep-moi-giang-vien-/main/frame.png";
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const frameImg = new Image();
    frameImg.crossOrigin = "anonymous";
    frameImg.src = frameUrl;

    // Khi frame load xong thì vẽ frame lần đầu
    frameImg.onload = () => {
      ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
    };

    // Khi người dùng tải ảnh lên
    document.getElementById("upload").addEventListener("change", e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = ev => {
        const userImg = new Image();
        userImg.onload = () => {
          // Xóa canvas cũ
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // Vẽ ảnh người (tròn)
          const x = 640, y = 240, r = 90;
          ctx.save();
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(userImg, x - r, y - r, 2 * r, 2 * r);
          ctx.restore();

          // Vẽ lại frame đè lên
          ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
        };
        userImg.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // Nút tải ảnh
    document.getElementById("download").addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "thiep-giang-vien.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
